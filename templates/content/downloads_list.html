{% extends "base.html" %}
{% load access_tags %}

{% block title %}Downloads | AI Shipping Labs{% endblock %}
{% block meta_description %}Downloadable resources: PDFs, slides, notebooks, and more for building AI agents and practical systems.{% endblock %}

{% block body %}
{% include "includes/header.html" %}
<main class="min-h-screen pt-24">
  <section class="py-16 lg:py-24">
    <div class="mx-auto max-w-4xl px-6 lg:px-8">
      <div class="mb-12">
        <p class="text-sm font-medium uppercase tracking-widest text-accent">Downloads</p>
        <h1 class="mt-4 text-3xl font-semibold tracking-tight sm:text-4xl" style="text-wrap: balance;">
          Downloadable Resources
        </h1>
        <p class="mt-4 text-lg text-muted-foreground">
          PDFs, slides, notebooks, and other resources to help you build AI agents and practical systems.
        </p>
      </div>

      {% if all_tags %}
      <div class="mb-8 flex flex-wrap items-center gap-2">
        <span class="text-sm text-muted-foreground mr-2">Filter by tag:</span>
        <a href="/downloads"
           class="rounded-full px-3 py-1 text-xs transition-colors {% if not current_tag %}bg-accent text-accent-foreground{% else %}bg-secondary text-muted-foreground hover:bg-secondary/80{% endif %}">
          All
        </a>
        {% for tag in all_tags %}
        <a href="/downloads?tag={{ tag }}"
           class="rounded-full px-3 py-1 text-xs transition-colors {% if current_tag == tag %}bg-accent text-accent-foreground{% else %}bg-secondary text-muted-foreground hover:bg-secondary/80{% endif %}">
          {{ tag }}
        </a>
        {% endfor %}
      </div>
      {% endif %}

      {% if current_tag %}
      <div class="mb-6">
        <p class="text-sm text-muted-foreground">
          Showing downloads tagged with <span class="font-medium text-foreground">"{{ current_tag }}"</span>
          <a href="/downloads" class="ml-2 text-accent hover:underline">Clear filter</a>
        </p>
      </div>
      {% endif %}

      {% if downloads %}
      <div class="grid gap-6 sm:grid-cols-2">
        {% for item in downloads %}
        <article class="group rounded-lg border border-border bg-card overflow-hidden transition-colors hover:border-accent/50">
          {% if item.download.cover_image_url %}
          <div class="aspect-video w-full overflow-hidden bg-muted">
            <img src="{{ item.download.cover_image_url }}" alt="{{ item.download.title }}" class="h-full w-full object-cover transition-transform group-hover:scale-105">
          </div>
          {% endif %}
          <div class="p-6">
            <div class="flex items-center gap-2 mb-3">
              <span class="rounded-full px-2.5 py-0.5 text-xs font-medium {{ item.download.file_type_color }}">
                {{ item.download.file_type_label }}
              </span>
              {% if item.download.human_file_size %}
              <span class="text-xs text-muted-foreground">{{ item.download.human_file_size }}</span>
              {% endif %}
              {% if item.download.required_level > 0 %}
              <i data-lucide="lock" class="inline h-4 w-4 text-muted-foreground"></i>
              {% endif %}
            </div>

            <h2 class="text-lg font-semibold text-foreground group-hover:text-accent transition-colors">
              {{ item.download.title }}
            </h2>

            {% if item.download.description %}
            <p class="mt-2 text-sm text-muted-foreground line-clamp-2">{{ item.download.description }}</p>
            {% endif %}

            {% if item.download.tags %}
            <div class="mt-3 flex flex-wrap gap-1.5">
              {% for tag in item.download.tags %}
              <a href="/downloads?tag={{ tag }}" class="rounded-full bg-secondary px-2 py-0.5 text-xs text-muted-foreground hover:bg-secondary/80 transition-colors" onclick="event.stopPropagation();">{{ tag }}</a>
              {% endfor %}
            </div>
            {% endif %}

            <div class="mt-4">
              {% if item.show_email_form %}
                <!-- Lead magnet: show email signup prompt -->
                <div class="rounded-lg border border-accent/30 bg-accent/5 p-4 text-center">
                  <p class="text-sm text-muted-foreground mb-2">Enter your email to download for free</p>
                  <a href="/accounts/signup?next=/api/downloads/{{ item.download.slug }}/file"
                     class="inline-flex items-center gap-2 rounded-lg bg-accent px-4 py-2 text-sm font-medium text-accent-foreground transition-colors hover:bg-accent/90">
                    <i data-lucide="mail" class="h-4 w-4"></i>
                    Sign Up to Download
                  </a>
                </div>
              {% elif item.has_access %}
                <!-- Authorized: show download button -->
                <a href="/api/downloads/{{ item.download.slug }}/file"
                   class="inline-flex items-center gap-2 rounded-lg bg-accent px-4 py-2 text-sm font-medium text-accent-foreground transition-colors hover:bg-accent/90">
                  <i data-lucide="download" class="h-4 w-4"></i>
                  Download
                </a>
              {% else %}
                <!-- Unauthorized: show upgrade CTA -->
                <div class="rounded-lg border border-border bg-muted/30 p-4 text-center">
                  <p class="text-sm text-muted-foreground mb-2">{{ item.cta_message }}</p>
                  <a href="/pricing"
                     class="inline-flex items-center gap-2 rounded-lg border border-accent/50 px-4 py-2 text-sm font-medium text-accent transition-colors hover:bg-accent/10">
                    <i data-lucide="arrow-up-right" class="h-4 w-4"></i>
                    View Pricing
                  </a>
                </div>
              {% endif %}
            </div>
          </div>
        </article>
        {% endfor %}
      </div>
      {% else %}
      <div class="rounded-lg border border-border bg-card p-12 text-center">
        <i data-lucide="download" class="mx-auto h-12 w-12 text-muted-foreground"></i>
        <p class="mt-4 text-lg text-muted-foreground">
          {% if current_tag %}
          No downloads found with tag "{{ current_tag }}".
          <a href="/downloads" class="text-accent hover:underline">View all downloads</a>
          {% else %}
          No downloadable resources yet. Check back soon.
          {% endif %}
        </p>
      </div>
      {% endif %}
    </div>
  </section>
</main>
{% include "includes/footer.html" %}
{% endblock %}
